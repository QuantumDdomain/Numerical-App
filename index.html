<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Root Finder</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/pyodide/v0.22.2/full/pyodide.js"></script>
</head>
<body>
    <h1>Root Finder using Bisection and Newton-Raphson Methods</h1>

    <label for="algorithmSelect">Choose an Algorithm:</label>
    <select id="algorithmSelect">
        <option value="bisection">Bisection Method</option>
        <option value="newton_raphson">Newton-Raphson Method</option>
    </select>

    <br><br>

    <label for="func_expr">Enter function f(x):</label>
    <input type="text" id="func_expr" value="x**3 + 4*x**2 - 10">

    <br><br>

    <!-- Bisection Method Inputs -->
    <div id="bisectionInputs">
        <label for="lower">Enter lower bound (a):</label>
        <input type="number" id="lower" value="1">
        <br><br>
        <label for="upper">Enter upper bound (b):</label>
        <input type="number" id="upper" value="2">
        <br><br>
    </div>

    <!-- Newton-Raphson Method Inputs -->
    <div id="newtonInputs">
        <label for="x0">Enter initial guess (x0):</label>
        <input type="number" id="x0" value="1">
        <br><br>
    </div>

    <button onclick="loadPyodideAndRun()">Find Root</button>

    <div id="output"></div>

    <!-- JavaScript to handle Pyodide and run Python code -->
    <script type="text/javascript">
        let pyodideReady = false;

        async function loadPyodideAndRun() {
            if (!pyodideReady) {
                window.pyodide = await loadPyodide();
                pyodideReady = true;
            }

            const algorithm = document.getElementById("algorithmSelect").value;
            const expr = document.getElementById("func_expr").value;
            console.log("Expression:", expr);  // Log expression to check

            let pythonCode = '';
            let a, b, x0;

            if (algorithm === 'bisection') {
                a = parseFloat(document.getElementById("lower").value);
                b = parseFloat(document.getElementById("upper").value);
                if (isNaN(a) || isNaN(b)) {
                    alert("Please enter valid numeric values for the lower and upper bounds.");
                    return;
                }
                console.log("Bisection - a:", a, "b:", b);  // Log to ensure they are numbers
                pythonCode = await fetch('web_bisection_method.py').then(res => res.text());
            } else if (algorithm === 'newton_raphson') {
                x0 = parseFloat(document.getElementById("x0").value);
                if (isNaN(x0)) {
                    alert("Please enter a valid numeric value for the initial guess (x0).");
                    return;
                }
                console.log("Newton-Raphson - x0:", x0);  // Log to ensure x0 is defined
                pythonCode = await fetch('web_newton_raphson.py').then(res => res.text());
            }

            // Ensure both methods are available in the code
            const fullCode = `
          ${pythonCode}
          if ('a' in locals() and 'b' in locals()):
            result = bisection_method("${expr}", ${a}, ${b})
          else:
            result = newton_raphson_method("${expr}", ${x0})
          result
          `;

            try {
                const result = await pyodide.runPythonAsync(fullCode);
                document.getElementById("output").textContent = "Root: " + result;
            } catch (error) {
                console.error("Error in Python execution:", error);
                document.getElementById("output").textContent = "Error: " + error;
            }
        }
    </script>
</body>
</html>
