<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Derivative Calculator</title>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 2em; }
    input, select, button { padding: 0.5em; margin-top: 1em; width: 100%; }
    .result { margin-top: 1em; background: #f0f0f0; padding: 1em; border-radius: 8px; }
    .error { color: red; }
  </style>
</head>
<body>
  <h1>Derivative Calculator</h1>

  <label>Function (in terms of x):</label>
  <input id="expr" placeholder="e.g., sin(x) + x**2">

  <label>Value of x:</label>
  <input id="xval" type="number" placeholder="e.g., 0.5">

  <label>Step size h:</label>
  <input id="hval" type="number" placeholder="e.g., 0.01">

  <label>First Derivative Method:</label>
  <select id="method">
    <option value="3">3-Point Method</option>
    <option value="5">5-Point Method</option>
  </select>

  <label>
    <input type="checkbox" id="second"> Compute Second Derivative
  </label>

  <button onclick="runPython()">Calculate</button>

  <div id="output" class="result"></div>

  <script>
    let pyodide = null;

    async function main() {
      document.getElementById("output").textContent = "Loading Pyodide...";
      try {
        pyodide = await loadPyodide({ indexURL: "https://cdn.jsdelivr.net/pyodide/v0.23.4/full/" });
        const response = await fetch("web_derivative.py");
        const pythonCode = await response.text();
        await pyodide.runPythonAsync(pythonCode);
        document.getElementById("output").textContent = "Pyodide loaded. Ready to calculate.";
      } catch (err) {
        document.getElementById("output").innerHTML = `<div class="error">Error loading Pyodide or Python code: ${err}</div>`;
        console.error(err);
      }
    }

    main();

    async function runPython() {
      if (!pyodide) {
        document.getElementById("output").innerHTML = "<div class='error'>Pyodide is still loading...</div>";
        return;
      }

      try {
        const expr = document.getElementById("expr").value;
        const xval = document.getElementById("xval").value;
        const hval = document.getElementById("hval").value;
        const method = document.getElementById("method").value;
        const second = document.getElementById("second").checked;

        let pyResult = pyodide.globals.get("calculate_derivatives")(
          expr, xval, hval, method, second
        ).toJs();

        let output = `<b>First Derivative (${method}-point):</b> ${pyResult["first"]}<br>`;
        if ("second" in pyResult) {
          output += `<b>Second Derivative:</b> ${pyResult["second"]}`;
        }

        document.getElementById("output").innerHTML = output;
      } catch (err) {
        document.getElementById("output").innerHTML = `<div class="error">Error during calculation: ${err}</div>`;
        console.error(err);
      }
    }
  </script>
</body>
</html>
