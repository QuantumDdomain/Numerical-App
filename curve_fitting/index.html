<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Curve Fitting Tool</title>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f7f7f7;
      padding: 20px;
    }
    .container {
      max-width: 700px;
      margin: auto;
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    textarea, input, button, select {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #3498db;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #2980b9;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
    }
    #output {
      margin-top: 20px;
      padding: 15px;
      background: #ecf0f1;
      border-radius: 8px;
      white-space: pre-line;
    }
  </style>
</head>
<body>

<div class="container">
  <h1>Curve Fitting Tool</h1>
  <label>Select model type:</label>
  <select id="modelType">
    <option value="linear">y = a*x + b</option>
    <option value="power">y = a*x^b</option>
    <option value="exponential">y = a * b^x</option>
    <option value="custom">y = a*x^b + c*x^d</option>
  </select>

  <label>Enter x values (e.g. [1, 2, 3, 4]):</label>
  <textarea id="xInput">[1, 2, 3, 4, 5]</textarea>

  <label>Enter y values (e.g. [2.3, 4.1, 5.9, 8.0]):</label>
  <textarea id="yInput">[2.3, 4.1, 5.9, 8.0, 10.2]</textarea>

  <button onclick="runCode()">Fit Curve</button>
  <pre id="output">Output will appear here...</pre>
</div>

<script type="text/python">
import numpy as np
from scipy.optimize import curve_fit
from js import document

def linear(x, a, b):
    return a * x + b

def power(x, a, b):
    return a * np.power(x, b)

def exponential(x, a, b):
    return a * np.power(b, x)

def custom(x, a, b, c, d):
    return a * np.power(x, b) + c * np.power(x, d)

def fit_curve(x, y, model):
    if model == "linear":
        popt, _ = curve_fit(linear, x, y)
        return "y = a*x + b\nParameters:\na = {:.4f}, b = {:.4f}".format(*popt)
    elif model == "power":
        popt, _ = curve_fit(power, x, y)
        return "y = a*x^b\nParameters:\na = {:.4f}, b = {:.4f}".format(*popt)
    elif model == "exponential":
        popt, _ = curve_fit(exponential, x, y)
        return "y = a*b^x\nParameters:\na = {:.4f}, b = {:.4f}".format(*popt)
    elif model == "custom":
        popt, _ = curve_fit(custom, x, y)
        return "y = a*x^b + c*x^d\nParameters:\na = {:.4f}, b = {:.4f}, c = {:.4f}, d = {:.4f}".format(*popt)
    else:
        return "Unknown model selected."

try:
    x_vals = eval(document.getElementById("xInput").value)
    y_vals = eval(document.getElementById("yInput").value)
    model_type = document.getElementById("modelType").value

    if not (isinstance(x_vals, list) and isinstance(y_vals, list)):
        raise ValueError("x and y inputs must be lists.")
    if len(x_vals) != len(y_vals):
        raise ValueError("x and y must have the same length.")

    x_vals = np.array(x_vals, dtype=float)
    y_vals = np.array(y_vals, dtype=float)

    result = fit_curve(x_vals, y_vals, model_type)
except Exception as e:
    result = f"❌ Error: {e}"

document.getElementById("output").innerText = result
</script>

<script>
let pyodide;
async function runCode() {
  if (!pyodide) {
    document.getElementById("output").textContent = "⏳ Loading Pyodide...";
    pyodide = await loadPyodide();
    await pyodide.loadPackage("scipy");
    await pyodide.loadPackage("numpy");
    document.getElementById("output").textContent = "✅ Pyodide loaded. Ready!";
  }

  try {
    await pyodide.runPythonAsync(document.querySelector("script[type='text/python']").textContent);
  } catch (err) {
    document.getElementById("output").innerText = "❌ Python Error:\n" + err;
  }
}
</script>

</body>
</html>
